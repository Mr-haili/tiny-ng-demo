!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["tiny-ng"]=e():t["tiny-ng"]=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=138)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(48);e.Program=n.Program;var i=r(50);e.Statement=i.Statement;var o=r(42);e.ExpressionStatement=o.ExpressionStatement;var s=r(3);e.Expression=s.Expression;var a=r(37);e.AssignmentExpression=a.AssignmentExpression;var u=r(40);e.ConditionalExpression=u.ConditionalExpression;var p=r(45);e.LogicalExpression=p.LogicalExpression;var c=r(38);e.BinaryExpression=c.BinaryExpression;var l=r(51);e.UnaryExpression=l.UnaryExpression;var f=r(46);e.MemberExpression=f.MemberExpression;var h=r(39);e.CallExpression=h.CallExpression;var _=r(43);e.Identifier=_.Identifier;var y=r(44);e.Literal=y.Literal;var d=r(49);e.Property=d.Property;var b=r(47);e.ObjectExpression=b.ObjectExpression;var v=r(36);e.ArrayExpression=v.ArrayExpression;var m=r(41);e.Constant=m.Constant;var O=r(1);e.Ast=O.Ast,e.ESTree=O.ESTree},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(11);e.Tree=n.default;var i=r(6);e.Ast=i.default;var o=r(21);e.ParseTree=o.default;var s=r(60);e.RuleNode=s.default;var a=r(61);e.TerminalNode=a.default;var u=r(57);e.ESTree=u.default;var p=r(59);e.ParseTreeVisitor=p.default;var c=r(58);e.ParseTreeVisitFuncTable=c.default},,function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i.default);e.Expression=o,e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(10),o=r(8);!function(t){t[t.Terminal=0]="Terminal",t[t.Nonterminal=1]="Nonterminal",t[t.RuleEnd=2]="RuleEnd",t[t.EOF=3]="EOF"}(n||(n={})),e.GrammarSymbolType=n;var s=function(){function t(e,r){if("string"==typeof e){var s,a=e;return this.symbol=a,s=t.isTerminal(a)?n.Terminal:n.Nonterminal,i.EOF===a&&(s=n.EOF),void(this.type=s)}if(e instanceof o.default){var u=e;return this.production=u,this.type=r,void(n.RuleEnd===r&&(this.symbol="↑"))}}return t.isTerminal=function(t){var e=t.charAt(0);return"'"===e||e===e.toUpperCase()},t.isNonTerminal=function(t){return!this.isTerminal(t)},t.isEpsilon=function(t){return t===i.EPSILON},t.isEOF=function(t){return t===i.EOF},t.get=function(e){return this._registry.hasOwnProperty(e)||(this._registry[e]=new t(e)),this._registry[e]},t._registry={},t.EOF=new t(i.EOF),t}();e.GrammarSymbol=s,e.default=s},,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.toJson=function(){return{type:this.type,ivalue:this.ivalue,children:this.children?this.children.map(function(t){return t?t.toJson():null}):null}},t}();e.Ast=n,e.default=n},,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4),i=r(4),o=function(){function t(t,e){this.pid=e;var r=t.split("->");this.start=r[0].trim(),this.expression=r[1].trim().split(/\s+/),""===this.expression[0]&&(this.expression=[]);var o=this.expression.map(function(t){return i.default.get(t)});o.push(new i.default(this,n.GrammarSymbolType.RuleEnd)),this.statusList=o,this.bnfForm=this.start+" -> "+this.expression.join(" ")}return Object.defineProperty(t.prototype,"symbols",{get:function(){return[this.start].concat(this.expression)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEpsilon",{get:function(){return 0===this.expression.length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.bnfForm},t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(10),i=r(4),o=function(){function t(t,e){this.grammar=t,this._debug=!1,this._isSetsGen=!0,this._firstSets={},this._followSets={},this._firstSetsOfProduction=new Map,this._selectSetsOfProduction=new Map,this._setsGen(e)}return t.prototype._setsGen=function(t){this._firstSetsGen(),this._followSetsGen(),t&&t(this),this._firstSetsOfProductiongGen(),this._selectSetsOfProductionGen(),this._isSetsGen=!1},t.prototype.first=function(t,e){if("string"==typeof t){var r=t;return e&&this._isSetsGen&&(this._firstSets[r]=e),this._firstSets[r]||new Set}var i=t,o=new Set,s=0,a=i.length;if(0===a)return new Set(n.EPSILON);for(var u=void 0;(u=i[s])&&(o=o.union(this.first(u)),o.has(n.EPSILON));s++);return s!==a&&o.delete(n.EPSILON),o},t.prototype.follow=function(t,e){return e&&this._isSetsGen&&(this._followSets[t]=e),this._followSets[t]||new Set},t.prototype.firstOfProduction=function(t,e){return this._isSetsGen&&e&&this._firstSetsOfProduction.set(t,e),this._firstSetsOfProduction.get(t)||new Set},t.prototype.selectOfProduction=function(t,e){return this._isSetsGen&&e&&this._selectSetsOfProduction.set(t,e),this._selectSetsOfProduction.get(t)||new Set},t.prototype._firstSetsGen=function(){var t=this;this.grammar.terminals.forEach(function(e){return t.first(e,new Set([e]))});for(var e,r,n,i=this.grammar.productions,o=!0,s=0;o;){s+=1,o=!1;for(var a=0,u=i;a<u.length;a++)e=u[a],r=this.first(e.start),n=r.union(this.first(e.expression)),this._debug&&(console.log("-------------------------"),console.log("firsetSets计算第${ count }轮:"),console.log(e.bnfForm+", sets: ",n)),r.size!=n.size&&(o=!0,this.first(e.start,n))}},t.prototype._followSetsGen=function(){var t,e,r,o,s,a,u=this.grammar.productions.filter(function(t){return!t.isEpsilon});for(this.follow(this.grammar.entrySymbol,new Set(n.EOF)),t=!0;t;){t=!1;for(var p=0,c=u;p<c.length;p++){var l=c[p];e=l.start,r=l.expression,o=this.follow(e);for(var f=0,h=void 0;h=r[f];f++)i.default.isTerminal(h)||(s=this.follow(h),a=s.union(this.first(r.slice(f+1))),a.has(n.EPSILON)&&(a=a.union(o)),a.delete(n.EPSILON),s.size!=a.size&&(t=!0,this.follow(h,a)))}}},t.prototype._firstSetsOfProductiongGen=function(){for(var t=0,e=this.grammar.productions;t<e.length;t++){var r=e[t];this.firstOfProduction(r,this.first(r.expression))}},t.prototype._selectSetsOfProductionGen=function(){for(var t,e=0,r=this.grammar.productions;e<r.length;e++){var i=r[e];t=this.firstOfProduction(i).union(new Set),t.has(n.EPSILON)&&(t=t.union(this.follow(i.start))),t.delete(n.EPSILON),this.selectOfProduction(i,t)}},t}();e.SetsGenerator=o,e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EPSILON="ε",e.EOF="$"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return Object.defineProperty(t.prototype,"childCount",{get:function(){return this.children?this.children.length:0},enumerable:!0,configurable:!0}),t}();e.default=n},,,function(t,e,r){"use strict";function n(t){t||(t="");var e=u.default.parse(t);return e=c.optimize(e),Object.assign(function(t,r){return p.exec(e,t,r)},{expression:t,literal:i(e),constant:o(e)})}function i(t){return-1!==l.indexOf(t.type)}function o(t){return i(t)&&t instanceof a.Constant}Object.defineProperty(e,"__esModule",{value:!0});var s=r(30),a=r(0),u=r(31),p=new s.Interpreter,c=new s.AstOptimizer;e.$parse=n;var l=[a.ESTree.type.Literal,a.ESTree.type.ArrayExpression,a.ESTree.type.ObjectExpression,"Constant"];e.default=n},,,function(t,e,r){"use strict";function n(t){return null==t}Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=r(0),s=r(34),a=function(){function t(){}return t.prototype.exec=function(t,e,r){if(void 0===e&&(e={}),null==t)return null;this._env=e,this._locals=r,t.accept(this);var n=this._result;return this._env=null,this._locals=null,this._result=null,n},t.prototype._putValue=function(t,e){return t.base[t.name]=e},t.prototype._getValue=function(t,e){void 0===e&&(e=!1);var r=t.base,i=t.name;if(!n(r))return n(r[i])&&e&&(r[i]={}),r[i]},t.prototype._evalAstList=function(t){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];i?(i.accept(this),e.push(this._result)):e.push(null)}return e},t.prototype.eval=function(t){var e;switch(t.type){case i.ESTree.type.Program:e=this.evalProgram(t);break;case i.ESTree.type.ExpressionStatement:e=this.evalExpressionStatement(t);break;case i.ESTree.type.AssignmentExpression:e=this.evalAssignmentExpression(t);break;case i.ESTree.type.ConditionalExpression:e=this.evalConditionalExpression(t);break;case i.ESTree.type.LogicalExpression:e=this.evalLogicalExpression(t);break;case i.ESTree.type.BinaryExpression:e=this.evalBinaryExpression(t);break;case i.ESTree.type.UnaryExpression:e=this.evalUnaryExprssion(t);break;case i.ESTree.type.Identifier:e=this.evalIdentifier(t);break;case i.ESTree.type.Literal:e=this.evalLiteral(t);break;case"Constant":e=this.evalConstant(t);break;case i.ESTree.type.ObjectExpression:e=this.evalObjectExpression(t);break;case i.ESTree.type.ArrayExpression:e=this.evalArrayExpression(t);break;case i.ESTree.type.MemberExpression:e=this.evalMemberExpression(t);break;case i.ESTree.type.CallExpression:e=this.evalCallExpression(t);break;default:throw"ast interpreter: 未知的抽象语法树类型 "+t.type}this._result=e},t.prototype.evalProgram=function(t){var e=t.body;return this._evalAstList(e).pop()},t.prototype.evalExpressionStatement=function(t){return t.expression.accept(this),this._result},t.prototype.evalAssignmentExpression=function(t){var e=this._fetchReference(t.left,!0);t.right.accept(this);var r=this._result;return this._putValue(e,r),r},t.prototype.evalIdentifier=function(t,e){void 0===e&&(e=!1);var r=this._fetchReference(t);return this._getValue(r,e)},t.prototype.evalMemberExpression=function(t,e){void 0===e&&(e=!1);var r=this._fetchReference(t,e);return this._getValue(r,e)},t.prototype.evalLiteral=function(t){return t.value},t.prototype.evalConstant=function(t){return t.value},t.prototype.evalUnaryExprssion=function(t){var e=t.operator;t.argument.accept(this);var r=this._result;this._isDefined(r)||(r=0);var n;switch(e){case"+":n=+r;break;case"-":n=-r;break;case"!":n=!r;break;default:throw"evalUnaryExpr 不认识的一元运算符: F"+e+"F"}return n},t.prototype.evalBinaryExpression=function(t){var e=t.operator;t.left.accept(this);var r=this._result;t.right.accept(this);var n=this._result;if("+"===e){if(void 0===r)return n;if(void 0===n)return r}"-"===e&&(this._isDefined(r)||(r=0),this._isDefined(n)||(n=0));var i;switch(e){case"+":i=r+n;break;case"-":i=r-n;break;case"*":i=r*n;break;case"/":i=r/n;break;case"%":i=r%n;break;case"===":i=r===n;break;case"!==":i=r!==n;break;case"==":i=r==n;break;case"!=":i=r!=n;break;case">=":i=r>=n;break;case"<=":i=r<=n;break;case">":i=r>n;break;case"<":i=r<n;break;default:throw"evalBinaryExpr 不认识的二元运算符: "+e}return i},t.prototype.evalLogicalExpression=function(t){var e=t.operator;t.left.accept(this);var r=this._result;switch(e){case"&&":return r?(t.right.accept(this),this._result):r;case"||":return r||(t.right.accept(this),r,this._result);default:throw"interpreter: evalLogicalExpression 不认识的逻辑运算符: "+e}},t.prototype.evalConditionalExpression=function(t){return t.test.accept(this),this._result?t.consequent.accept(this):t.alternate.accept(this),this._result},t.prototype.evalObjectExpression=function(t){for(var e,r,n={},i=0,s=t.properties;i<s.length;i++){var a=s[i];e=a.key,r=e instanceof o.Literal?e.value:e.name,a.value.accept(this),n[r]=this._result}return n},t.prototype.evalArrayExpression=function(t){return this._evalAstList(t.elements)},t.prototype._fetchReference=function(t,e){void 0===e&&(e=!1);var r,i="";if(t instanceof o.Identifier&&(i=t.name,r=n(this._locals[i])?this._env:this._locals),t instanceof o.MemberExpression){var a=t,u=a.object;e&&this._isAssignableExpression(u)?u instanceof o.Identifier?r=this.evalIdentifier(u,e):u instanceof o.MemberExpression&&(r=this.evalMemberExpression(u,e)):(a.object.accept(this),r=this._result),a.computed?(a.property.accept(this),i=this._result):i=a.property.name}return new s.default(r,i)},t.prototype.evalCallExpression=function(t){var e,r=t.callee,n=void 0;if(r instanceof o.MemberExpression){var i=this._fetchReference(r);e=this._getValue(i),n=i.base}else r.accept(this),e=this._result,n=this._env;if(e){var s=this._evalAstList(t.arguments);return e.apply(n,s)}},t.prototype._isAssignableExpression=function(t){return t instanceof o.Identifier||t instanceof o.MemberExpression},t.prototype._isDefined=function(t){return void 0!==t},t}();e.Interpreter=a,e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4),i=r(8),o=r(1),s=function(){function t(t,e,r){var s=[],a=new Set,u=new Set,p=this.parseTreeVisitFuncTable=new o.ParseTreeVisitFuncTable;t.forEach(function(t){return p.addVisitFunc(t.terminal,t.visitFunc)});for(var c,l=void 0,f=0;l=e[f];f++)c=new i.default(l.bnf,f),s.push(c),p.addVisitFunc(f,l.visitFunc||null);for(var h=0,_=s;h<_.length;h++)for(var y=_[h],d=0,b=y.symbols;d<b.length;d++){var v=b[d];n.default.isNonTerminal(v)?u.add(v):a.add(v)}this.productions=s,this.terminals=a,this.nonterminals=u,this.symbols=this.terminals.union(this.nonterminals),this.entrySymbol=r}return t.prototype.getProductionsByStart=function(t){return this.productions.filter(function(e){return e.start===t})},t.prototype.getProductionByPid=function(t){return this.productions[t]},t.prototype.printProductions=function(){this.productions.forEach(function(t){return console.log(t.bnfForm)})},t}();e.Grammar=s,e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(10),i=function(){function t(t,e,r,n,i,o){this._type=t,this._text=e,r||(this._value=e)}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineNum",{get:function(){return this._lineNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"charNum",{get:function(){return this._charNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tokenNum",{get:function(){return this._tokenNum},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"type: "+this.type+", text: "+this.text},t.EOF=new t(n.EOF,n.EOF),t}();e.Token=i,e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Set.prototype.union=function(t){var e=new Set(this);return t.forEach(function(t){return e.add(t)}),e},Set.prototype.intersection=function(t){var e=this,r=new Set;return t.forEach(function(t){return e.has(t)?r.add(t):null}),r},Set.prototype.difference=function(t){var e=new Set(this);return t.forEach(function(t){return e.delete(t)}),e}},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(11),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i.default);e.default=o},,,,,,,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r(20);var n=r(6);e.Ast=n.Ast;var i=r(17);e.Interpreter=i.Interpreter;var o=r(35);e.AstOptimizer=o.AstOptimizer;var s=r(0);e.ESTree=s.ESTree,e.Expression=s.Expression,e.Constant=s.Constant},function(t,e,r){"use strict";function n(t){return-1!==["||","&&"].indexOf(t)}function i(t,e){var r=e.children,n=r[0],i=r[1],o=t.visit(n);return t.visit(i,o)}function o(t,e,r){if(!e.production||e.production.isEpsilon)return r;var i,o=t.visit(e.getChild(1)),s=e.firstChild.payload.text;n(s)?d.LogicalExpression:d.BinaryExpression;return i=n(s)?new d.LogicalExpression(s,r,o):new d.BinaryExpression(s,r,o),t.visit(e.getChild(2),i)}function s(t,e){var r=e.firstChild.payload.text,n=t.visit(e.lastChild);return new d.UnaryExpression(r,n)}function a(t){return t.type===_.ESTree.type.Identifier||t.type===_.ESTree.type.MemberExpression}function u(t,e){var r=t.visit(e.firstChild);return t.visit(e.lastChild,r)}function p(t,e,r){if(!e.production||e.production.isEpsilon)return r;var n=e.firstChild.payload.text,i=t.visit(e.getChild(1)),o=t.visit(e.lastChild,i);if(!a(r))throw"assign_exp -> add_exp assign_exp_plus访问改写出错, add_exp实际成树后只能是Identifier或MemberExpression, 当前返回类型为"+r.type;return new d.AssignmentExpression(n,r,o)}function c(t){var e,r=t.payload,n=r.text;switch(r.type){case y.LITERAL_UNDEFINED:case y.LITERAL_NULL:e=null;break;case y.LITERAL_BOOL:e="true"===n;break;case y.LITERAL_STR:e=n.slice(1,-1);break;case y.LITERAL_NUM:e=parseFloat(n);break;default:throw"未知的字面量token类型: "+r.type}return new d.Literal(e)}Object.defineProperty(e,"__esModule",{value:!0});var l=r(53),f=r(52),h=r(56),_=r(1),y=r(65),d=r(0),b=[{type:"SPACE",pattern:"\\s",isIgnore:!0},{type:y.ENTER,pattern:"\\n",isIgnore:!0},{type:y.TAB,pattern:"\\t",isIgnore:!0},{type:y.OPEN_PAREN,pattern:"\\("},{type:y.CLOSE_PAREN,pattern:"\\)"},{type:y.OPEN_SQUARE,pattern:"\\["},{type:y.CLOSE_SQUARE,pattern:"\\]"},{type:y.OPEN_CURLY,pattern:"{"},{type:y.CLOSE_CURLY,pattern:"}"},{type:y.COMMA,pattern:","},{type:y.COLON,pattern:":"},{type:y.QUESTION_MARK,pattern:"\\?"},{type:y.DOT,pattern:"\\."},{type:y.SEMICOLON,pattern:";"},{type:y.LITERAL_NULL,pattern:"null"},{type:y.LITERAL_UNDEFINED,pattern:"undefined"},{type:y.LITERAL_BOOL,pattern:"(true|false)"},{type:y.LITERAL_STR,pattern:"'[^']*'"},{type:y.LITERAL_STR,pattern:'"[^"]*"'},{type:y.LITERAL_NUM,pattern:"(\\d+)(\\.\\d+)?"},{type:y.WHILE,pattern:"while"},{type:y.IF,pattern:"if"},{type:y.VAR,pattern:"var"},{type:y.FUNC,pattern:"function"},{type:y.OP_EQUAL,pattern:"(===|!==|==|!=)"},{type:y.OP_LOGICAL,pattern:"(&&|\\|\\|)"},{type:y.OP_RELATION,pattern:"(>=|<=|>|<)"},{type:y.OP_ASSIGN,pattern:"="},{type:y.OP_ADD,pattern:"[\\+-]"},{type:y.OP_MULT,pattern:"[\\*/%]"},{type:y.OP_NOT,pattern:"!"},{type:y.IDENTIFIER,pattern:"[$_A-Za-z][_A-Za-z0-9]*"}],v=[{terminal:y.IDENTIFIER,visitFunc:function(t){return new d.Identifier(t.payload.text)}}];["UNDEFINED","NULL","BOOL","NUM","STR"].forEach(function(t){var e="LITERAL_"+t;v.push({terminal:e,visitFunc:c})});var m=[{bnf:"program -> statement_list",visitFunc:function(t,e){var r=new d.Program;return t.visit(e.firstChild,r),r}},{bnf:"statement_list -> "},{bnf:"statement_list -> statement statement_list_plus",visitFunc:function(t,e,r){var n=t.visit(e.firstChild);return r.body.push(n),t.visit(e.lastChild,r)}},{bnf:"statement_list -> SEMICOLON statement_list"},{bnf:"statement_list_plus -> SEMICOLON statement_list"},{bnf:"statement_list_plus -> "},{bnf:"statement -> exp",visitFunc:function(t,e){var r=t.visit(e.firstChild);return new d.ExpressionStatement(r)}},{bnf:"exp -> assign_exp"},{bnf:"assign_exp -> conditional_exp assign_exp_plus",visitFunc:u},{bnf:"assign_exp_plus -> OP_ASSIGN conditional_exp assign_exp_plus",visitFunc:p},{bnf:"assign_exp_plus ->",visitFunc:p},{bnf:"conditional_exp -> logical_exp conditional_exp_plus",visitFunc:function(t,e){var r=t.visit(e.firstChild);return t.visit(e.lastChild,r)}},{bnf:"conditional_exp_plus -> "},{bnf:"conditional_exp_plus -> QUESTION_MARK assign_exp COLON assign_exp",visitFunc:function(t,e,r){var n=t.visit(e.getChild(1)),i=t.visit(e.lastChild);return new d.ConditionalExpression(r,n,i)}},{bnf:"logical_exp -> equal_exp logical_exp_plus",visitFunc:i},{bnf:"logical_exp_plus -> OP_LOGICAL equal_exp logical_exp_plus",visitFunc:o},{bnf:"logical_exp_plus -> ",visitFunc:o},{bnf:"equal_exp -> relation_exp equal_exp_plus",visitFunc:i},{bnf:"equal_exp_plus -> OP_EQUAL relation_exp equal_exp_plus",visitFunc:o},{bnf:"equal_exp_plus -> ",visitFunc:o},{bnf:"relation_exp -> add_exp relation_exp_plus",visitFunc:i},{bnf:"relation_exp_plus -> OP_RELATION add_exp relation_exp_plus",visitFunc:o},{bnf:"relation_exp_plus -> ",visitFunc:o},{bnf:"add_exp -> mult_exp add_exp_plus",visitFunc:i},{bnf:"add_exp_plus -> OP_ADD mult_exp add_exp_plus",visitFunc:o},{bnf:"add_exp_plus -> ",visitFunc:o},{bnf:"mult_exp -> unary_exp mult_exp_plus",visitFunc:i},{bnf:"mult_exp_plus -> OP_MULT unary_exp mult_exp_plus",visitFunc:o},{bnf:"mult_exp_plus -> ",visitFunc:o},{bnf:"unary_exp -> OP_NOT unary_exp",visitFunc:s},{bnf:"unary_exp -> OP_ADD unary_exp",visitFunc:s},{bnf:"unary_exp -> lhs_exp"},{bnf:"lhs_exp -> primary postfix_list",visitFunc:function(t,e){var r=t.visit(e.firstChild);return t.visit(e.lastChild,r)}},{bnf:"postfix_list -> "},{bnf:"postfix_list -> postfix postfix_list",visitFunc:function(t,e,r){var n=t.visit(e.firstChild,r);return t.visit(e.lastChild,n)}},{bnf:"postfix -> postfix_access"},{bnf:"postfix -> postfix_subscript"},{bnf:"postfix -> postfix_call"},{bnf:"postfix_access -> DOT IDENTIFIER",visitFunc:function(t,e,r){var n=t.visit(e.lastChild);return new d.MemberExpression(r,n,!1)}},{bnf:"postfix_subscript -> OPEN_SQUARE exp CLOSE_SQUARE",visitFunc:function(t,e,r){var n=t.visit(e.getChild(1));return new d.MemberExpression(r,n,!0)}},{bnf:"postfix_call -> arguments",visitFunc:function(t,e,r){var n=new d.CallExpression(r);return t.visit(e.firstChild,n),n}},{bnf:"arguments -> OPEN_PAREN argument_list CLOSE_PAREN"},{bnf:"argument_list -> "},{bnf:"argument_list -> exp argument_list_plus",visitFunc:function(t,e,r){var n=t.visit(e.firstChild);return r.arguments.push(n),t.visit(e.lastChild,r)}},{bnf:"argument_list_plus -> "},{bnf:"argument_list_plus -> COMMA argument_list"},{bnf:"primary -> IDENTIFIER"},{bnf:"primary -> literal"},{bnf:"primary -> array_exp"},{bnf:"primary -> object_exp"},{bnf:"primary -> OPEN_PAREN exp CLOSE_PAREN"},{bnf:"literal -> LITERAL_UNDEFINED"},{bnf:"literal -> LITERAL_NULL"},{bnf:"literal -> LITERAL_BOOL"},{bnf:"literal -> LITERAL_NUM"},{bnf:"literal -> LITERAL_STR"},{bnf:"array_exp -> OPEN_SQUARE element_list CLOSE_SQUARE",visitFunc:function(t,e){var r=new d.ArrayExpression;return t.visit(e.getChild(1),r),r}},{bnf:"element_list ->"},{bnf:"element_list -> exp element_list_plus",visitFunc:function(t,e,r){var n=t.visit(e.firstChild);return r.elements.push(n),t.visit(e.lastChild,r)}},{bnf:"element_list -> COMMA element_list",visitFunc:function(t,e,r){return r.elements.push(null),t.visit(e.lastChild,r)}},{bnf:"element_list_plus -> COMMA element_list"},{bnf:"element_list_plus -> "},{bnf:"object_exp -> OPEN_CURLY property_def_list CLOSE_CURLY",visitFunc:function(t,e){var r=new d.ObjectExpression;return t.visit(e.getChild(1),r)}},{bnf:"property_def_list -> property_def property_def_list_plus",visitFunc:function(t,e,r){var n=t.visit(e.firstChild);return r.properties.push(n),t.visit(e.lastChild,r)}},{bnf:"property_def_list -> "},{bnf:"property_def_list_plus -> "},{bnf:"property_def_list_plus -> COMMA property_def_list"},{bnf:"property_def -> property_name COLON exp",visitFunc:function(t,e){var r=t.visit(e.getChild(0)),n=t.visit(e.getChild(2));return new d.Property(r,n)}},{bnf:"property_name -> literal"},{bnf:"property_name -> IDENTIFIER"}],O=new l.Lexer(b),E=new f.Grammar(v,m,"program"),g=new h.default(E,O,function(t){var e=t.follow("assign_exp_plus");t.follow("assign_exp_plus",e.difference(new Set(["OP_ASSIGN"])))});e.default=g},,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,r){void 0===r&&(r=!0),this.base=t,this.name=e,this.strict=r}return t.prototype.isStrictReference=function(){return this.strict},t.prototype.hasPrimitiveBase=function(){return-1!==["number","string","boolean"].indexOf(typeof this.base)},t.prototype.isPropertyReference=function(){return this.base instanceof Object||this.hasPrimitiveBase()},t.prototype.isUnresolvableReference=function(){return void 0===this.base},t}();e.Reference=n,e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=r(0),o=r(17),s=function(){function t(){this._interpreter=new o.default,this._placeholder=new i.Constant(null),this._result=this._placeholder,this._logicalExpressionTruthTable={102:1,2:0,201:0,200:2,112:0,12:1,211:2,210:0}}return t.prototype.optimize=function(t){return null==t?null:(t.accept(this),this._result)},t.prototype.eval=function(t){var e=this._placeholder;switch(t.type){case n.ESTree.type.Program:e=this.optimizeProgram(t);break;case n.ESTree.type.ExpressionStatement:e=this.optimizeExpressionStatement(t);break;case n.ESTree.type.AssignmentExpression:e=this.optimizeAssignmentExpression(t);break;case n.ESTree.type.ConditionalExpression:e=this.optimizeConditionalExpression(t);break;case n.ESTree.type.LogicalExpression:e=this.optimizeLogicalExpression(t);break;case n.ESTree.type.BinaryExpression:e=this.optimizeBinaryExpression(t);break;case n.ESTree.type.UnaryExpression:e=this.optimizeUnaryExprssion(t);break;case n.ESTree.type.Identifier:e=this.optimizeIdentifier(t);break;case n.ESTree.type.Literal:e=this.optimizeLiteral(t);break;case n.ESTree.type.Property:e=this.optimizeProperty(t);break;case n.ESTree.type.ObjectExpression:e=this.optimizeObjectExpression(t);break;case n.ESTree.type.ArrayExpression:e=this.optimizeArrayExpression(t);break;case n.ESTree.type.MemberExpression:e=this.optimizeMemberExpression(t);break;case n.ESTree.type.CallExpression:e=this.optimizeCallExpression(t)}this._result=e},t.prototype.optimizeProgram=function(t){var e=this;if(t.body=t.body.map(function(t){return t.accept(e),e._result}),1===t.body.length)return t.body[0];if(0===t.body.length)return new i.Constant(null);for(var r=!0,n=0,o=t.body;n<o.length;n++){if(!(o[n]instanceof i.Constant)){r=!1;break}}return r?t.body[t.body.length-1]:t},t.prototype.optimizeExpressionStatement=function(t){return t.expression.accept(this),this._result},t.prototype.optimizeAssignmentExpression=function(t){return t.left.accept(this),t.left=this._result,t.right.accept(this),t.right=this._result,t},t.prototype.optimizeConditionalExpression=function(t){t.test.accept(this),t.test=this._result,t.consequent.accept(this),t.consequent=this._result,t.alternate.accept(this),t.alternate=this._result;var e=t.test;return e instanceof i.Constant?e.value?t.consequent:t.alternate:t},t.prototype._codeLogicalSymbol=function(t){return"&&"===t?0:"||"===t?1:t instanceof i.Constant?t.value?1:0:2},t.prototype._optimizeExpressions=function(t){var e=this;return t.map(function(t){return t?(t.accept(e),e._result):new i.Constant(null)})},t.prototype.optimizeLogicalExpression=function(t){var e=this,r=t.operator;t.left.accept(this);var n=t.left=this._result;t.right.accept(this);var o=t.right=this._result,s=Number(n instanceof i.Constant)+Number(o instanceof i.Constant);if(2===s)return new i.Constant(this._interpreter.exec(t));if(0===s)return t;var a=0;return[n,r,o].forEach(function(t){return a=10*a+e._codeLogicalSymbol(t)}),[n,o,t][this._logicalExpressionTruthTable[a]]},t.prototype.optimizeBinaryExpression=function(t){t.left.accept(this);var e=t.left=this._result;t.right.accept(this);var r=t.right=this._result;if(e instanceof i.Constant&&r instanceof i.Constant){var n=this._interpreter.exec(t);return new i.Constant(n)}return t},t.prototype.optimizeUnaryExprssion=function(t){if(t.argument.accept(this),t.argument=this._result,t.argument instanceof i.Constant){var e=this._interpreter.exec(t);return new i.Constant(e)}return t},t.prototype.optimizeIdentifier=function(t){return t},t.prototype.optimizeLiteral=function(t){return new i.Constant(t)},t.prototype.optimizeProperty=function(t){return t.value.accept(this),t.value=this._result,t},t.prototype.optimizeObjectExpression=function(t){t.properties=this._optimizeExpressions(t.properties);for(var e=!0,r=0,n=t.properties;r<n.length;r++){if(!(n[r].value instanceof i.Constant)){e=!1;break}}if(!e)return t;var o=this._interpreter.exec(t);return new i.Constant(o)},t.prototype.optimizeArrayExpression=function(t){t.elements=this._optimizeExpressions(t.elements);for(var e=!0,r=0,n=t.elements;r<n.length;r++){if(!(n[r]instanceof i.Constant)){e=!1;break}}if(!e)return t;var o=this._interpreter.exec(t);return new i.Constant(o)},t.prototype.optimizeMemberExpression=function(t){t.object.accept(this);var e=t.object=this._result;t.computed&&(t.property.accept(this),t.property=this._result);var r=t.property;return e instanceof i.Constant&&(r instanceof i.Constant||r instanceof i.Identifier)?new i.Constant(this._interpreter.exec(t)):t},t.prototype.optimizeCallExpression=function(t){var e=this;return t.callee.accept(this),t.callee=this._result,t.arguments=t.arguments.map(function(t){return t.accept(e),e._result}),t},t}();e.AstOptimizer=s},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e){void 0===e&&(e=[]);var r=t.call(this)||this;return r.elements=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"ArrayExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return"array"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.elements.slice(0)},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Expression);e.ArrayExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e,r,n){var i=t.call(this)||this;return i.operator=e,i.left=r,i.right=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"AssignmentExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.operator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.left,this.right]},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.eval(this)},e}(i.Expression);e.AssignmentExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=function(t){function e(e,r,n){var i=t.call(this)||this;return i.operator=e,i.left=r,i.right=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"BinaryExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.operator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.left,this.right]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.default);e.BinaryExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e,r){var n=t.call(this)||this;return n.callee=e,n.arguments=r instanceof Array?r:[],n}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"CallExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return"CallExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.arguments.slice(0)},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.arguments[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Expression);e.CallExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=function(t){function e(e,r,n){var i=t.call(this)||this;return i.test=e,i.consequent=r,i.alternate=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"ConditionalExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.test,this.consequent,this.alternate]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Ast);e.ConditionalExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e){var r=t.call(this)||this;if(r._isContainer=!1,e instanceof i.Literal)r._value=e.value;else if(!1==e instanceof Object||e instanceof RegExp)r._value=e;else{r._isContainer=!0;try{r._value=JSON.stringify(e)}catch(t){throw console.error("Constant: 只接受Literal, 基础类型, 正则表达式, 以及能够转换为JSON字符串的Object"),t}}return r}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._isContainer?JSON.parse(this._value):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return"Constant"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.value?this.value.toString():null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return null},e.prototype.accept=function(t){t.eval(this)},e.prototype.toJson=function(){return{type:this.type,ivalue:this.value}},e}(i.Expression);e.Constant=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e){var r=t.call(this)||this;return r.expression=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"ExpressionStatement"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.expression]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Statement);e.ExpressionStatement=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=function(t){function e(e){var r=t.call(this)||this;return r.name=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"Identifier"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return null},e.prototype.accept=function(t){t.eval(this)},e}(i.default);e.Identifier=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=function(t){function e(e){var r=t.call(this)||this;return r.value=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"Literal"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.value?this.value.toString():null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return null},e.prototype.accept=function(t){t.eval(this)},e.prototype.toJson=function(){return{type:this.type}},e}(i.default);e.Literal=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=function(t){function e(e,r,n){var i=t.call(this)||this;return i.operator=e,i.left=r,i.right=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"LogicalExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.operator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.left,this.right]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.default);e.LogicalExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e,r,n){var i=t.call(this)||this;return i.object=e,i.property=r,i.computed=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"MemberExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.object+"."},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return null},e.prototype.accept=function(t){t.eval(this)},e}(i.Expression);e.MemberExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),o=function(t){function e(e){void 0===e&&(e=[]);var r=t.call(this)||this;return r.properties=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"ObjectExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return"object"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.properties.slice(0)},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Expression);e.ObjectExpression=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=function(t){function e(e){void 0===e&&(e=[]);var r=t.call(this)||this;return r.body=e,r}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"Program"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.body.slice()},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.body[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Ast);e.Program=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=function(t){function e(e,r,n){void 0===n&&(n="init");var i=t.call(this)||this;return i.key=e,i.value=r,i.kind=n,i}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"Property"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.key.ivalue||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.value]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.Ast);e.Property=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i.default);e.Statement=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=function(t){function e(e,r){var n=t.call(this)||this;return n.operator=e,n.argument=r,n.prefix=!0,n}return n(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"UnaryExpression"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ivalue",{get:function(){return this.operator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return[this.argument]},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.children[t]},e.prototype.accept=function(t){t.eval(this)},e}(i.default);e.UnaryExpression=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r(20);var n=r(18);e.Grammar=n.Grammar;var i=r(4);e.GrammarSymbol=i.default;var o=r(8);e.Production=o.default;var s=r(9);e.SetsGenerator=s.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(54);e.Lexer=n.Lexer;var i=r(19);e.Token=i.Token},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(19),i=function(){function t(t){void 0===t&&(t=[]);var e=this;this._lexRuleList=[],t.forEach(function(t){return e.addRule(t)})}return t.prototype.tokenize=function(t){for(var e,r=[];t.length>0;){if(!(e=this._match(t))){var i="(0,0,0): error : token 匹配失败, 当前文本: "+t;throw console.log(i),"匹配失败, 不认识的字符"}var o=e.token;e.lexRule.isIgnore||r.push(o),t=t.slice(o.text.length)}return r.push(n.default.EOF),r},t.prototype.addRule=function(t){var e=t.type,r=t.pattern,n=t.evaluator,i=t.isIgnore;this._lexRuleList.push({type:e,pattern:r,regex:new RegExp("^"+r),isIgnore:i,evaluator:n})},t.prototype._match=function(t){for(var e,r,i,o=this._lexRuleList,s=0,a=o;s<a.length;s++){var u=a[s];if(u.regex&&(e=t.match(u.regex)))return r=e[0],u.evaluator?u.evaluator(r):r,i=new n.default(u.type,r,r),{token:i,lexRule:u}}return null},t}();e.Lexer=i,e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(18),i=r(9),o=function(){function t(t){this.grammarOrSetsGenerator=t,this._table={},t instanceof n.default?(this.grammar=t,this.setsGenerator=new i.default(this.grammar)):(this.setsGenerator=t,this.grammar=this.setsGenerator.grammar),this._build()}return t.prototype.query=function(t,e){var r=this._table[t][e];return this.grammar.getProductionByPid(r)},t.prototype._build=function(){var t,e=this.grammar,r=this.setsGenerator,n=this._table;e.nonterminals.forEach(function(t){return n[t]={}});for(var i=0,o=e.productions;i<o.length;i++){var s=o[i];!function(e){t=e.start,r.selectOfProduction(e).forEach(function(r){void 0!==e.pid&&(n[t][r]=e.pid)})}(s)}},t.prototype.print=function(){console.log(this._table)},t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(4),o=r(55),s=r(1),a=function(){function t(t,e,r){this.grammar=t,this.lexer=e,this.parseTreeRoot=new s.RuleNode("root"),this.isDebug=!1;var i=new n.SetsGenerator(t,r);this.parseTable=new o.default(i),this.parseTreeVisitor=new s.ParseTreeVisitor(t.parseTreeVisitFuncTable)}return t.prototype._reset=function(t){this._stack=[i.GrammarSymbol.get(this.grammar.entrySymbol),i.GrammarSymbol.EOF],this._tokens=t,this._tokenIndex=0,this._ctx=this.parseTreeRoot},Object.defineProperty(t.prototype,"_currentStatus",{get:function(){return this._stack[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lookahead",{get:function(){return this._tokens[this._tokenIndex]},enumerable:!0,configurable:!0}),t.prototype._nextToken=function(){this._tokenIndex+=1},t.prototype.parse=function(t){var e=this.parseForParseTree(t);return this.parseTreeVisitor.visit(e)},t.prototype.parseForParseTree=function(t){var e;e="string"==typeof t?this.lexer.tokenize(t):t,this._reset(e);for(var r,n=!1;!n;)switch(this.isDebug&&this.printParseStack(),r=this._currentStatus,r.type){case i.GrammarSymbolType.Terminal:this._match(r.symbol);break;case i.GrammarSymbolType.Nonterminal:this._enterRule();break;case i.GrammarSymbolType.RuleEnd:this._exitRule();break;case i.GrammarSymbolType.EOF:if(this._lookahead.type!==r.symbol)throw new Error("at the end of parse, expecting: EOF; but found: "+this._lookahead.type);n=!0;break;default:throw new Error("unknown grammar symbol type")}return this._ctx.removeChild(this._ctx.firstChild)},t.prototype._match=function(t){if(this._lookahead.type===t)return this._consume();throw new Error("expecting: "+t+"; but found: "+this._lookahead.type)},t.prototype._consume=function(){var t=this._lookahead,e=new s.TerminalNode(t);return this._ctx.addChild(e),this._nextToken(),this._stack.shift(),t},t.prototype._enterRule=function(){var t=this._currentStatus.symbol,e=this._lookahead.type,r=this.parseTable.query(t,e);if(!r)throw new Error("非终结符为: "+t+", 向前看1符号为: "+e+", 无法查找到对应的产生式");var n=new s.RuleNode(r);this._ctx.addChild(n),this._ctx=n,this._stack.shift(),this._stack=r.statusList.concat(this._stack)},t.prototype._exitRule=function(){this._ctx=this._ctx.getParent(),this._stack.shift()},t.prototype.printParseStack=function(){var t=this._stack.map(function(t){return t.symbol}).join(" "),e=this._tokens.slice(this._tokenIndex).map(function(t){return t.text}).join(" ");console.log(t+" \t "+e)},t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;!function(t){!function(t){t.Program="Program",t.Expression="Expression",t.ExpressionStatement="ExpressionStatement",t.ThisExpression="ThisExpression",t.ArrayExpression="ArrayExpression",t.ObjectExpression="ObjectExpression",t.Property="Property",t.UnaryExpression="UnaryExpression",t.BinaryExpression="BinaryExpression",t.AssignmentExpression="AssignmentExpression",t.LogicalExpression="LogicalExpression",t.MemberExpression="MemberExpression",t.ConditionalExpression="ConditionalExpression",t.CallExpression="CallExpression",t.Identifier="Identifier",t.Literal="Literal"}(t.type||(t.type={}))}(n||(n={})),e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(){this._ruleVisitFuncs=[],this._terminalVisitFuncs={}}return t.prototype.getRuleVisitFunc=function(t){var e=t.production;if(!e||null===e.pid)throw"ruleNode 没有绑定对应产生式, 或者传入的产生式无pid, "+e;var r=this._ruleVisitFuncs[e.pid];return r||(r=this._defaultRuleVisitFuncs),r},t.prototype.getTerminalVisitFunc=function(t){var e=this._terminalVisitFuncs[t.type];if(!e)throw"terminalNode: "+t.type+", 未注册对应的访问函数";return e},t.prototype.addVisitFunc=function(t,e){if("number"==typeof t){var r=t;this._ruleVisitFuncs[r]=e}if("string"==typeof t){var n=t;this._terminalVisitFuncs[n]=e}},t.prototype._defaultRuleVisitFuncs=function(t,e,r){if(0===e.childCount)return r;if(1===e.childCount)return t.visit(e.firstChild,r);var i=0,o=0;if(e.children.forEach(function(t,e){t instanceof n.TerminalNode||(i+=1,o=e)}),1!==i)throw"当前节点: "+e+",\n\t\t\t\t默认parseTree处理规则只能处理子节点中RuleNode数量等于1的情况,\n\t\t \t\t当前节点子节点中RuleNode数量为: "+i;return t.visit(e.getChild(o),r)},t}();e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(t){this._visitFuncTable=t}return t.prototype.visit=function(t,e){if(t instanceof n.RuleNode){var r=t;return this._visitFuncTable.getRuleVisitFunc(r)(this,r,e)}var i=t;return this._visitFuncTable.getTerminalVisitFunc(i)(i)},t}();e.default=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(21),o=function(t){function e(e){var r=t.call(this)||this;if(r._children=[],"string"==typeof e)return r._symbol=e,r;var n=e;return r._symbol=n.start,r.production=n,r}return n(e,t),Object.defineProperty(e.prototype,"payload",{get:function(){return this._symbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.payload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.payload},enumerable:!0,configurable:!0}),e.prototype.setParent=function(t){this._parent=t},e.prototype.getParent=function(){return this._parent},Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this._children[t]},Object.defineProperty(e.prototype,"firstChild",{get:function(){return this._children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){var t=this.children;return t[t.length-1]},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){return this._children.push(t),t.setParent(this),t},e.prototype.removeChild=function(t){var e=this._children.indexOf(t);return-1===e?t:(t.setParent(null),this._children.splice(e,1),t)},Object.defineProperty(e.prototype,"text",{get:function(){return this.toString()},enumerable:!0,configurable:!0}),e.prototype.toJson=function(){return{type:this.type,payload:this.payload,children:this.children?this.children.map(function(t){return t.toJson()}):null}},e.prototype.toString=function(){return this.name},e}(i.default);e.default=o},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=r(11),o=function(t){function e(e){var r=t.call(this)||this;return r._token=e,r}return n(e,t),Object.defineProperty(e.prototype,"payload",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.payload.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this.payload},enumerable:!0,configurable:!0}),e.prototype.setParent=function(t){this._parent=t},e.prototype.getParent=function(){return this._parent},Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return null},Object.defineProperty(e.prototype,"text",{get:function(){return this.token.text},enumerable:!0,configurable:!0}),e.prototype.toJson=function(){return{type:this.type,payload:this.payload}},e.prototype.toStringTree=function(){return this.toString()},e.prototype.toString=function(){return this.token.text},e}(i.default);e.default=o},,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COLON="COLON",e.COMMA="COMMA",e.DOT="DOT",e.QUESTION_MARK="QUESTION_MARK",e.OPEN_PAREN="OPEN_PAREN",e.CLOSE_PAREN="CLOSE_PAREN",e.OPEN_SQUARE="OPEN_SQUARE",e.CLOSE_SQUARE="CLOSE_SQUARE",e.OPEN_CURLY="OPEN_CURLY",e.CLOSE_CURLY="CLOSE_CURLY",e.SEMICOLON="SEMICOLON",e.SPACE="SPACE",e.ENTER="ENTER",e.TAB="TAB",e.WHILE="WHILE",e.IF="IF",e.VAR="VAR",e.FUNC="FUNC",e.OP_ASSIGN="OP_ASSIGN",e.OP_LOGICAL="OP_LOGICAL",e.OP_EQUAL="OP_EQUAL",e.OP_RELATION="OP_RELATION",e.OP_ADD="OP_ADD",e.OP_MULT="OP_MULT",e.OP_NOT="OP_NOT",e.OP_COMMA="OP_COMMA",e.IDENTIFIER="IDENTIFIER",e.LITERAL_UNDEFINED="LITERAL_UNDEFINED",e.LITERAL_NULL="LITERAL_NULL",e.LITERAL_BOOL="LITERAL_BOOL",e.LITERAL_NUM="LITERAL_NUM",e.LITERAL_STR="LITERAL_STR"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(30);e.Ast=n.Ast,e.AstOptimizer=n.AstOptimizer;var i=r(14);e.$parse=i.default;var o=r(31);e.parser=o.default}])});